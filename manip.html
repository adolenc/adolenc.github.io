<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bezier Curve Manipulation</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #canvas {
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <button onclick="addBezierCurve()">Add Bezier Curve</button>
  <canvas id="canvas"></canvas>
  <div id="output"></div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const curves = [];
    let selectedPoint = null;
    let activeCurve = null; // Track the currently active curve for intermediate point visibility

    // Load and set background image, adjust canvas size
    const background = new Image();
    background.src = 'bg.jpg';
    background.onload = () => {
      canvas.width = background.width;
      canvas.height = background.height;
      ctx.drawImage(background, 0, 0, canvas.width, canvas.height);
    };

    // Add a new Bezier curve with default control points
    function addBezierCurve() {
      const curve = {
        p0: { x: 100, y: 300 },
        p1: { x: 200, y: 100 },
        p2: { x: 300, y: 100 },
        p3: { x: 400, y: 300 },
      };
      curves.push(curve);
      updateOutput();
      draw();
    }
    function addPredefinedBezierCurve(pts) {
      const curve = {
        p0: {x: pts[0].x, y: pts[0].y},
        p1: {x: pts[1].x, y: pts[1].y},
        p2: {x: pts[2].x, y: pts[2].y},
        p3: {x: pts[3].x, y: pts[3].y},
      }
      curves.push(curve);
      updateOutput();
      draw();
    }
    let pts = [
//       // face shape
//   [ {x: 122.574462890625, y: 196.53191757202148}, {x: 180.574462890625, y: 198.53191757202148}, {x: 261.574462890625, y: 180.53191757202148}, {x: 359.574462890625, y: 141.53191757202148} ],
//   [ {x: 132.574462890625, y: 192.53191757202148}, {x: 155.574462890625, y: 246.53191757202148}, {x: 118.574462890625, y: 253.53191757202148}, {x: 116.574462890625, y: 272.5319175720215} ],
//   [ {x: 116.574462890625, y: 272.5319175720215}, {x: 114.574462890625, y: 310.5319175720215}, {x: 134.574462890625, y: 338.5319175720215}, {x: 131.574462890625, y: 376.5319175720215} ],
//   [ {x: 131.574462890625, y: 376.5319175720215}, {x: 129.574462890625, y: 417.5319175720215}, {x: 174.574462890625, y: 432.5319175720215}, {x: 203.574462890625, y: 445.5319175720215} ],
//   [ {x: 359.574462890625, y: 145.53191757202148}, {x: 386.574462890625, y: 183.53191757202148}, {x: 362.574462890625, y: 209.53191757202148}, {x: 378.574462890625, y: 249.53191757202148} ],
//   [ {x: 346.574462890625, y: 437.5319175720215}, {x: 372.574462890625, y: 409.5319175720215}, {x: 380.574462890625, y: 344.5319175720215}, {x: 384.574462890625, y: 291.5319175720215} ],
//   [ {x: 220.574462890625, y: 409.5319175720215}, {x: 199.574462890625, y: 434.5319175720215}, {x: 201.574462890625, y: 462.5319175720215}, {x: 222.574462890625, y: 465.5319175720215} ],
//   [ {x: 222.574462890625, y: 466.5319175720215}, {x: 271.574462890625, y: 496.5319175720215}, {x: 326.574462890625, y: 483.5319175720215}, {x: 345.574462890625, y: 438.5319175720215} ],
//   [ {x: 333.574462890625, y: 406.5319175720215}, {x: 341.574462890625, y: 415.5319175720215}, {x: 346.574462890625, y: 431.5319175720215}, {x: 345.574462890625, y: 437.5319175720215} ],
//   [ {x: 221.574462890625, y: 410.5319175720215}, {x: 248.574462890625, y: 451.5319175720215}, {x: 335.574462890625, y: 445.5319175720215}, {x: 333.574462890625, y: 406.5319175720215} ],
//       // glasses
// [ {x: 134.0638427734375, y: 245.53191757202148}, {x: 149.0638427734375, y: 249.53191757202148}, {x: 164.0638427734375, y: 254.53191757202148}, {x: 176.0638427734375, y: 257.5319175720215} ],
// [ {x: 127.0638427734375, y: 255.53191757202148}, {x: 146.0638427734375, y: 259.5319175720215}, {x: 160.0638427734375, y: 264.5319175720215}, {x: 175.0638427734375, y: 270.5319175720215} ],
// [ {x: 177.0638427734375, y: 255.53191757202148}, {x: 204.0638427734375, y: 250.53191757202148}, {x: 239.0638427734375, y: 248.53191757202148}, {x: 273.0638427734375, y: 256.5319175720215} ],
// [ {x: 176.0638427734375, y: 255.53191757202148}, {x: 175.0638427734375, y: 283.5319175720215}, {x: 181.0638427734375, y: 296.5319175720215}, {x: 192.0638427734375, y: 292.5319175720215} ],
// [ {x: 192.0638427734375, y: 292.5319175720215}, {x: 217.0638427734375, y: 293.5319175720215}, {x: 272.0638427734375, y: 311.5319175720215}, {x: 272.0638427734375, y: 258.5319175720215} ],
// [ {x: 273.0638427734375, y: 255.53191757202148}, {x: 286.0638427734375, y: 256.5319175720215}, {x: 296.0638427734375, y: 255.53191757202148}, {x: 304.0638427734375, y: 254.53191757202148} ],
// [ {x: 273.0638427734375, y: 263.5319175720215}, {x: 282.0638427734375, y: 261.5319175720215}, {x: 292.0638427734375, y: 260.5319175720215}, {x: 302.0638427734375, y: 264.5319175720215} ],
// [ {x: 304.0638427734375, y: 254.53191757202148}, {x: 305.0638427734375, y: 272.5319175720215}, {x: 309.0638427734375, y: 302.5319175720215}, {x: 338.0638427734375, y: 294.5319175720215} ],
// [ {x: 338.0638427734375, y: 295.5319175720215}, {x: 368.0638427734375, y: 290.5319175720215}, {x: 394.0638427734375, y: 300.5319175720215}, {x: 392.0638427734375, y: 270.5319175720215} ],
// [ {x: 304.0638427734375, y: 255.53191757202148}, {x: 344.0638427734375, y: 250.53191757202148}, {x: 407.0638427734375, y: 235.53191757202148}, {x: 392.0638427734375, y: 270.5319175720215} ],
//       // eyebrows
// [ {x: 177.574462890625, y: 236.53191757202148}, {x: 197.574462890625, y: 228.53191757202148}, {x: 236.574462890625, y: 226.53191757202148}, {x: 259.574462890625, y: 228.53191757202148} ],
// [ {x: 165.574462890625, y: 246.53191757202148}, {x: 167.574462890625, y: 244.53191757202148}, {x: 173.574462890625, y: 239.53191757202148}, {x: 178.574462890625, y: 236.53191757202148} ],
// [ {x: 165.574462890625, y: 247.53191757202148}, {x: 192.574462890625, y: 241.53191757202148}, {x: 229.574462890625, y: 234.53191757202148}, {x: 257.574462890625, y: 242.53191757202148} ],
// [ {x: 257.574462890625, y: 243.53191757202148}, {x: 258.574462890625, y: 238.53191757202148}, {x: 259.574462890625, y: 232.53191757202148}, {x: 260.574462890625, y: 228.53191757202148} ],
// [ {x: 318.574462890625, y: 229.53191757202148}, {x: 338.574462890625, y: 228.53191757202148}, {x: 354.574462890625, y: 228.53191757202148}, {x: 373.574462890625, y: 226.53191757202148} ],
// [ {x: 313.574462890625, y: 242.53191757202148}, {x: 314.574462890625, y: 236.53191757202148}, {x: 316.574462890625, y: 232.53191757202148}, {x: 318.574462890625, y: 229.53191757202148} ],
// [ {x: 313.574462890625, y: 242.53191757202148}, {x: 337.574462890625, y: 240.53191757202148}, {x: 357.574462890625, y: 238.53191757202148}, {x: 374.574462890625, y: 238.53191757202148} ],
//       // nose
// [ {x: 308.574462890625, y: 295.5319175720215}, {x: 306.574462890625, y: 317.5319175720215}, {x: 324.574462890625, y: 319.5319175720215}, {x: 320.574462890625, y: 332.5319175720215} ],
// [ {x: 301.574462890625, y: 345.5319175720215}, {x: 310.574462890625, y: 340.5319175720215}, {x: 313.574462890625, y: 332.5319175720215}, {x: 321.574462890625, y: 332.5319175720215} ],
// [ {x: 267.574462890625, y: 334.5319175720215}, {x: 282.574462890625, y: 327.5319175720215}, {x: 293.574462890625, y: 336.5319175720215}, {x: 299.574462890625, y: 344.5319175720215} ],
//       // mouth
// [ {x: 345.574462890625, y: 359.5319175720215}, {x: 352.574462890625, y: 368.5319175720215}, {x: 352.574462890625, y: 381.5319175720215}, {x: 346.574462890625, y: 389.5319175720215} ],
// [ {x: 224.574462890625, y: 395.5319175720215}, {x: 206.574462890625, y: 382.5319175720215}, {x: 208.574462890625, y: 357.5319175720215}, {x: 226.574462890625, y: 364.5319175720215} ],
// [ {x: 227.574462890625, y: 374.5319175720215}, {x: 252.574462890625, y: 385.5319175720215}, {x: 270.574462890625, y: 358.5319175720215}, {x: 288.574462890625, y: 377.5319175720215} ],
// [ {x: 288.574462890625, y: 377.5319175720215}, {x: 308.574462890625, y: 359.5319175720215}, {x: 314.574462890625, y: 384.5319175720215}, {x: 327.574462890625, y: 375.5319175720215} ],
// [ {x: 226.574462890625, y: 376.5319175720215}, {x: 256.574462890625, y: 383.5319175720215}, {x: 310.574462890625, y: 382.5319175720215}, {x: 327.574462890625, y: 375.5319175720215} ],
// [ {x: 227.574462890625, y: 378.5319175720215}, {x: 252.574462890625, y: 401.5319175720215}, {x: 313.574462890625, y: 396.5319175720215}, {x: 326.574462890625, y: 375.5319175720215} ],
// [ {x: 250.574462890625, y: 398.5319175720215}, {x: 273.574462890625, y: 402.5319175720215}, {x: 291.574462890625, y: 398.5319175720215}, {x: 308.574462890625, y: 395.5319175720215} ],
// [ {x: 250.574462890625, y: 398.5319175720215}, {x: 268.574462890625, y: 426.5319175720215}, {x: 299.574462890625, y: 416.5319175720215}, {x: 309.574462890625, y: 396.5319175720215} ],
//       // ear
// [ {x: 125.574462890625, y: 337.5319175720215}, {x: 109.574462890625, y: 353.5319175720215}, {x: 91.574462890625, y: 338.5319175720215}, {x: 92.574462890625, y: 317.5319175720215} ],
// [ {x: 92.574462890625, y: 316.5319175720215}, {x: 92.574462890625, y: 297.5319175720215}, {x: 56.574462890625, y: 270.5319175720215}, {x: 79.574462890625, y: 251.53191757202148} ],
// [ {x: 81.574462890625, y: 251.53191757202148}, {x: 98.574462890625, y: 235.53191757202148}, {x: 104.574462890625, y: 269.5319175720215}, {x: 121.574462890625, y: 268.5319175720215} ],
// [ {x: 111.574462890625, y: 277.5319175720215}, {x: 77.574462890625, y: 289.5319175720215}, {x: 116.574462890625, y: 306.5319175720215}, {x: 108.574462890625, y: 320.5319175720215} ],
//       // hair
// [ {x: 133.574462890625, y: 385.5319175720215}, {x: 116.574462890625, y: 386.5319175720215}, {x: 111.574462890625, y: 403.5319175720215}, {x: 102.574462890625, y: 424.5319175720215} ],
// [ {x: 106.574462890625, y: 362.5319175720215}, {x: 110.574462890625, y: 383.5319175720215}, {x: 108.574462890625, y: 399.5319175720215}, {x: 102.574462890625, y: 424.5319175720215} ],
// [ {x: 79.574462890625, y: 389.5319175720215}, {x: 88.574462890625, y: 391.5319175720215}, {x: 101.574462890625, y: 387.5319175720215}, {x: 107.574462890625, y: 362.5319175720215} ],
// [ {x: 65.574462890625, y: 299.5319175720215}, {x: 96.574462890625, y: 323.5319175720215}, {x: 109.574462890625, y: 373.5319175720215}, {x: 79.574462890625, y: 389.5319175720215} ],
// [ {x: 65.574462890625, y: 299.5319175720215}, {x: 47.574462890625, y: 258.5319175720215}, {x: 37.574462890625, y: 217.53191757202148}, {x: 49.574462890625, y: 191.53191757202148} ],
// [ {x: 22.574462890625, y: 197.53191757202148}, {x: 31.574462890625, y: 198.53191757202148}, {x: 41.574462890625, y: 195.53191757202148}, {x: 50.574462890625, y: 191.53191757202148} ],
// [ {x: 23.574462890625, y: 198.53191757202148}, {x: 37.574462890625, y: 189.53191757202148}, {x: 48.574462890625, y: 182.53191757202148}, {x: 64.574462890625, y: 174.53191757202148} ],
// [ {x: 25.574462890625, y: 172.53191757202148}, {x: 38.574462890625, y: 176.53191757202148}, {x: 47.574462890625, y: 176.53191757202148}, {x: 65.574462890625, y: 176.53191757202148} ],
// [ {x: 26.574462890625, y: 172.53191757202148}, {x: 94.574462890625, y: 173.53191757202148}, {x: 71.574462890625, y: 105.53191757202148}, {x: 134.574462890625, y: 58.531917572021484} ],
// [ {x: 134.574462890625, y: 59.531917572021484}, {x: 186.574462890625, y: 18.531917572021484}, {x: 245.574462890625, y: 18.531917572021484}, {x: 261.574462890625, y: 31.531917572021484} ],
// [ {x: 262.0638427734375, y: 32.531917572021484}, {x: 313.0638427734375, y: 10.531917572021484}, {x: 315.0638427734375, y: 74.53191757202148}, {x: 377.0638427734375, y: 59.531917572021484} ],
// [ {x: 337.0638427734375, y: 71.53191757202148}, {x: 352.0638427734375, y: 69.53191757202148}, {x: 365.0638427734375, y: 66.53191757202148}, {x: 377.0638427734375, y: 58.531917572021484} ],
// [ {x: 337.0638427734375, y: 72.53191757202148}, {x: 357.0638427734375, y: 72.53191757202148}, {x: 371.0638427734375, y: 74.53191757202148}, {x: 389.0638427734375, y: 70.53191757202148} ],
// [ {x: 342.0638427734375, y: 80.53191757202148}, {x: 363.0638427734375, y: 81.53191757202148}, {x: 375.0638427734375, y: 76.53191757202148}, {x: 390.0638427734375, y: 70.53191757202148} ],
// [ {x: 371.0638427734375, y: 76.53191757202148}, {x: 414.0638427734375, y: 106.53191757202148}, {x: 408.0638427734375, y: 151.53191757202148}, {x: 414.0638427734375, y: 178.53191757202148} ],
// [ {x: 384.0638427734375, y: 298.5319175720215}, {x: 411.0638427734375, y: 272.5319175720215}, {x: 424.0638427734375, y: 200.53191757202148}, {x: 414.0638427734375, y: 179.53191757202148} ],
    ];
    for (let i = 0; i < pts.length; i++)
     addPredefinedBezierCurve(pts[i]);

    // Draw all curves
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

      curves.forEach(curve => {
        ctx.beginPath();
        ctx.moveTo(curve.p0.x, curve.p0.y);
        ctx.bezierCurveTo(curve.p1.x, curve.p1.y, curve.p2.x, curve.p2.y, curve.p3.x, curve.p3.y);
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'hsla(0,100%,50%,0.4)';
        ctx.stroke();
        
        // Draw endpoints
        [curve.p0, curve.p3].forEach(point => {
          ctx.beginPath();
          ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);
          ctx.fillStyle = 'blue';
          ctx.fill();
        });

        // Draw intermediate control points if this curve is active
        if (activeCurve === curve) {
          [curve.p1, curve.p2].forEach(point => {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);
            ctx.fillStyle = 'green';
            ctx.fill();
          });
        }
      });
    }

    // Find a control point near the mouse click
    function findControlPoint(x, y) {
      var min_dist = 999999999;
      var min = null;
      for (const curve of curves) {
        for (const point of [curve.p0, curve.p1, curve.p2, curve.p3]) {
          const dx = x - point.x;
          const dy = y - point.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < min_dist) {
            min = { point, curve };
            min_dist = dist;
          }
        }
      }
      return min;
    }

    // Update the output listing points for each curve
    function nw(w) {
      return w;
    }
    function nh(h) {
      return h;
    }
    function updateOutput() {
      const output = document.getElementById('output');
      output.innerHTML = curves.map(curve => 
        `[ {x: ${nw(curve.p0.x)}, y: ${nh(curve.p0.y)}}, {x: ${nw(curve.p1.x)}, y: ${nh(curve.p1.y)}}, {x: ${nw(curve.p2.x)}, y: ${nh(curve.p2.y)}}, {x: ${nw(curve.p3.x)}, y: ${nh(curve.p3.y)}} ],`
      ).join('<br>');
    }

    // Mouse events for dragging control points
    canvas.addEventListener('mousedown', (e) => {
      const mousePos = getMousePos(canvas, e);
      const result = findControlPoint(mousePos.x, mousePos.y);

      if (result) {
        selectedPoint = result.point;
        if (selectedPoint === result.curve.p0 || selectedPoint === result.curve.p3) {
          activeCurve = result.curve; // Set the current curve as active to show intermediate points
        }
      }
      draw();
    });

    canvas.addEventListener('mousemove', (e) => {
      if (selectedPoint) {
        const mousePos = getMousePos(canvas, e);
        selectedPoint.x = mousePos.x;
        selectedPoint.y = mousePos.y;
        updateOutput();
        draw();
      }
    });

    canvas.addEventListener('mouseup', () => {
      selectedPoint = null;
      draw();
    });

    // Helper function to get mouse position relative to canvas
    function getMousePos(canvas, event) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: event.clientX - rect.left,
        y: event.clientY - rect.top,
      };
    }
  </script>
</body>
</html>

